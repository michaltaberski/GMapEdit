def reproject(data)
  latitiude = []
  longitude = []
  data.split('|').each do |e|
    lat, lng = e.split(',')
    latitiude.push(lat.to_f)
    longitude.push(lng.to_f)
  end
  
  earth_radius = 6371009 # srednica ziemi w metrach
  lat_dist = Math::PI * earth_radius / 180.0
  y = latitiude.map{|l| l * lat_dist}
  x = longitude.map.with_index{|l,i| l * lat_dist * Math.cos(latitiude[i]*Math::PI/180)}
  area = 0.0
  for i in -1..(x.count-2)
    area += x[i] * (y[i+1] - y[i-1])
  end
  return (area/2.0).abs
  
end

ibiza_data = "39.072317000100185,1.3800754547119265|39.06165463579012,1.3704624176025515|39.06858535579973,1.3539829254150515|39.04565806958091,1.3223972320556765|39.022723339464896,1.2921848297119265|39.004050041394386,1.2894382476806765|38.98750671727577,1.288751602172864|38.97576394758706,1.3045444488525515|38.96668865528569,1.295618057250989|38.96508701240613,1.233819961547864|38.95120459063666,1.2166538238525515|38.939455801863154,1.2358798980713015|38.89992286097444,1.2152805328369265|38.87800999362194,1.2235202789306765|38.85715977405873,1.2509860992431765|38.875871791008535,1.2660923004150515|38.875871791008535,1.2963047027588015|38.85929853954904,1.320337295532239|38.867318337236966,1.3498630523681765|38.864645171851826,1.387628555297864|38.85020834198508,1.3663425445556765|38.832559347917766,1.378015518188489|38.83362910853157,1.4047946929931765|38.895113298422324,1.4130344390869265|38.91221248532213,1.441186904907239|38.91221248532213,1.474145889282239|38.939455801863154,1.5036716461181765|38.9480005686174,1.527704238891614|38.977899141483924,1.530450820922864|38.99017525694312,1.560663223266614|38.99017525694312,1.584009170532239|39.02592398119339,1.6052951812744265|39.062720944698,1.593622207641614|39.09097226187526,1.6011753082275515|39.10269590138121,1.545557022094739|39.117081340145205,1.5215244293213015|39.099498738469464,1.5022983551025515|39.101630196520794,1.470026016235364|39.08617566572213,1.4281406402588015" 

print reproject(ibiza_data)/(1000*1000)

